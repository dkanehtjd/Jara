using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.SceneManagement;

public class LoadingSceneController : MonoBehaviour
{
    //???? ????
    static string nextScene;


    //???????? ?????? ???????? ???? ???? ????
    [SerializeField]
    Image progressBar;

    public static void LoadScene(string sceneName)
    {
        nextScene = sceneName; //?????????? ????
        SceneManager.LoadScene("LoadingScene");//?????????? ?????? ??????

    }

    // Start is called before the first frame update
    void Start()
    {
        StartCoroutine(LoadSceneProcess());
    }

    //?????????? ?????? ???????? ???? ??????
    IEnumerator LoadSceneProcess()
    {
        AsyncOperation op = SceneManager.LoadSceneAsync(nextScene);//?????? ???????? ?????? nextScene?? ?????????? 
                                                                   //SceneManager.LoadScene : ???????? ?? ???????? - ???? ?????????? ???? ???? ???? ???? ????
                                                                   //SceneManager.LoadSceneAsync : ??????????

        //AsyncOperation ?????? ???? op?? ????  allowSceneActivation?? false?? ???? 
        //?????? ???????? ???? ?????? ?????? ???????? ?????? ?????? ?????? ?????? ???? 
        //false : 90%???? ?????? ???????? ???? ?????? ???????? ???? ???? (true?? ?? ?? ???? ????)
        //  1.???????? ???? ?????? ???? ?? (???? ????:?????? ????)
        //  2. ???????????? ?? ???? ???? ???? ?????????? ?? (?????? ???? ????)
        op.allowSceneActivation = false;


        float timer = 0f;
        float speed = 0.2f;

        //float speed = 2f;
        //?? ?????? ?????? ???????? ???? ????
        while (!op.isDone)
        {
            yield return null;//?????? ?? ???? ???????? ???????? ??????????
            //???? ?????? ???????? ?????? ???? ?????? ???????? ???? ???????? ???????? ????

            if (op.progress < 0.9f)
            {
                progressBar.fillAmount = op.progress;//?????? ????????
            }
            else
            {
                //?????????? ????
                timer += Time.unscaledDeltaTime*speed;

                progressBar.fillAmount = Mathf.Lerp(0.1f, 1f, timer);
                if (progressBar.fillAmount >= 1f)//???? ??????
                {
                    yield return new WaitForSeconds(1f);
                    op.allowSceneActivation = true;
                    yield break;
                }
            }
        }
    }
}

